<!DOCTYPE html>
<html lang="en">

<head>
  <!--  Copyright (c) 2023-25 David Kerr, https://github.com/dkerr64 -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1">
  <meta name="apple-mobile-web-app-title" content="RATDGO">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>HomeKit Garage Door Opener</title>
  <link rel="stylesheet" href="style.css?v=CRC-32">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png?v=CRC-32" />
  <link rel="icon" type="image/png" sizes="64x64" href="/favicon-64x64.png?v=CRC-32" />
  <link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png?v=CRC-32" />
  <link rel="icon" type="image/x-icon" sizes="16x16 32x32 48x48" href="/favicon.ico?v=CRC-32" />
  <link rel="icon" type="image/svg+xml" sizes="any" href="/favicon.svg?v=CRC-32" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=CRC-32" />
  <link rel="manifest" href="/site.webmanifest?v=CRC-32" />
  <script src="qrcode.js?v=CRC-32"></script>
  <script src="marked.umd.js?v=CRC-32"></script>
  <script src="functions.js?v=CRC-32"></script>
</head>

<body>
  <!-- Title section of page ------------------------------------------------------------------>
  <div id="fullpage" class="fullpage">
    <div id="loader" class="ldrcenter"></div>
    <main>
      <div id="header" class="header">
        <div class="logo">
          <pre class="logo">
 _____ _____ _____ _____ ____  _____
| __  |  _  |_   _|   __|    \|     |
|    -|     | | | |  |  |  |  |  |  |
|__|__|__|__| |_| |_____|____/|_____|
          </pre>
          <p class="logo"> for HomeKit</p>
        </div>
        <div class="name">
          <p id="deviceName" style="margin:0px;">Garage Door</p>
        </div>
        <div
          style="float: right; vertical-align: middle; padding-left: 0; padding-right: 0; cursor: pointer; position: absolute; right: 0;">
          <img id="settings-icon" src="settings-sliders.svg?v=CRC-32" alt="Settings" style="width:1.5em;height:1.5em;">
          <img id="main-icon" src="garage-car.svg?v=CRC-32" alt="Homepage" onclick="history.back()"
            style="display:none; width:1.5em; height:1.5em;">
        </div>
      </div>
      <!-- Main section of page ------------------------------------------------------------------>
      <div id="main-page" style="padding: 0px; padding-bottom: 8px;">
        <div class="serverstatus">
          <table class="status">
            <tr>
              <td style="width: 30%">Firmware:</td>
              <td><span id="firmwareVersion"></span><br><sup style="font-size: 0.6em;"><span
                    id="newversion"></span><span id="dotdot1"></span></sup></td>
            </tr>
            <tr>
              <td style="white-space: pre;">Up Time:</td>
              <td><span id="upTime"></span><br><sup style="font-size: 0.6em;">(days:hrs:min:sec)</sup></td>
            </tr>
            <tr>
              <td>WiFi&nbsp;SSID:</td>
              <td id="wifiSSID"></td>
            </tr>
            <tr>
              <td>WiFi&nbsp;RSSI:</td>
              <td id="wifiRSSI"></td>
            </tr>
            <tr>
              <td>WiFi&nbsp;AP:</td>
              <td><span id="wifiBSSID"></span><br><sup style="font-size: 0.6em;"><span id="lockedAP"
                    style="display: none">(Locked to AP)</span></sup></td>
            </tr>
            <tr>
              <td>MAC&nbsp;Address:</td>
              <td id="macAddress"></td>
            </tr>
            <tr id="ipv6Row" style="display:none;">
              <td>IPv6&nbsp;Address:</td>
              <td id="ipv6Addresses" style="white-space:pre;"></td>
            </tr>
            <tr>
              <td>IP&nbsp;Address:</td>
              <td class="copy"><span class="copyTxt" id="localIP"></span>
                <img class="copyBtn" src="copy.svg?v=CRC-32" alt="copy IP clipboard" title="Copy to clipboard"
                  onclick="copyToClipboard(event)" style="width:1em;height: 1em; cursor: pointer; vertical-align: top;">
                <span class="copied"
                  style="font-size: 0.6em; position: relative; left: -2em; top: -.2em; visibility: hidden;">Copied</span>
              </td>
            </tr>
            <tr>
              <td>mDNS&nbsp;Name:</td>
              <td class="copy"><span class="copyTxt" id="mdnsName"></span>
                <img class="copyBtn" src="copy.svg?v=CRC-32" alt="copy mdns clipboard" title="Copy to clipboard"
                  onclick="copyToClipboard(event)" style="width:1em;height: 1em; cursor: pointer; vertical-align: top;">
                <span class="copied"
                  style="font-size: 0.6em; position: relative; left: -2em; top: -.2em; visibility: hidden;">Copied</span>
              </td>
            </tr>
            <tr>
              <td>Netmask:</td>
              <td id="subnetMask"></td>
            </tr>
            <tr>
              <td>Gateway&nbsp;IP:</td>
              <td id="gatewayIP"></td>
            </tr>
            <tr id="trAccessoryID" style="display: none;">
              <td style="padding-top: 10px;">HomeKit ID:</td>
              <td style="padding-top: 10px;"><span id="accessoryID"></span><br><sup style="font-size: 0.6em;">HomeKit
                  connected: <span id="clients">No</span></sup></td>
            </tr>
          </table>
        </div>
        <div class="qrcode">
          <img id="qrcode" src="qrframe.svg?v=CRC-32" alt="QR Code" style="display:none;">
          <svg id="qr-svg"
            style="display:none; position:absolute; top:35%; left:5%; width:90%; height:60%; padding:0px 12px 12px">
          </svg>
          <p id="re-pair-info" style="display:none; font-size: 10px;">If you wish to pair to another HomeKit home, you
            must first un-pair from existing home.
          </p>
        </div>
        <div class="fullwidth"
          style="padding-top: 0px; padding-bottom: 5px; padding-left: 0%; padding-right: 0%; display: flex; justify-content: space-between;">
          <input type="button" value="Reboot RATGDO" style="width: 28%;" onclick="rebootRATGDO(true)">
          <input type="button" value="Firmware Update" style="width: 28%;" onclick="showUpdateDialog()">
          <input type="button" id="unpair" value="Reset HomeKit" style="width: 28%;" onclick="unpairRATGDO()">
        </div>
        <div class="fullwidth">
          <table style="table-layout: fixed; width: 100%;">
            <colgroup>
              <col width="10%">
              <col width="14%">
              <col width="24%">
              <col width="5%">
              <col width="3%">
              <col width="13%">
              <col width="31%">
            </colgroup>
            <tr>
              <td colspan="2">Door State:</td>
              <td>
                <span id="garageDoorState"></span><span id="ttcActive" style="display: none;">&nbsp;in&nbsp;99</span>
              </td>
              <td colspan="3">Obstruction:</td>
              <td>
                <span id="garageObstructed"></span><span id="pinBasedObst"
                  style="font-size: 0.6em">&nbsp;(Pin-based)</span>
              </td>
            </tr>
            <tr id="lockLightRow">
              <td colspan="2">Remotes:</td>
              <td id="garageLockState"></td>
              <td colspan="3">Light&nbsp;On:</td>
              <td id="garageLightOn"></td>
            </tr>
            <tr>
              <td colspan="2">Door&nbsp;Protocol:</td>
              <td colspan="2" style="width: 35%;">
                <span id="GDOSecurityType"></span><span id="sec1emulation"
                  style="font-size: 0.6em; display: none">&nbsp;(Emulation)</span>
              </td>
              <td colspan="2" id="motionLabel">Motion:</td>
              <td id="garageMotion"></td>
            </tr>
            <tr id="secPlus2Row" style="display:none;">
              <td colspan="2">Cycle&nbsp;Count:</td>
              <td id="openingsCount"></td>
              <td colspan="3">Battery:</td>
              <td id="batteryState"></td>
            </tr>
            <tr id="durationRow">
              <td colspan="2">Opening:</td>
              <td id="openDuration">Unknown</td>
              <td colspan="3">Closing:</td>
              <td id="closeDuration">Unknown</td>
            </tr>
            <tr id="lastChangeRow">
              <td></td>
              <td id="doorOpenAt" colspan="3" style="font-size: 0.65em; text-align: left;"></td>
              <td colspan="1"></td>
              <td id="doorCloseAt" colspan="2" style="font-size: 0.65em; text-align: left;"></td>
            </tr>
            <tr id="vehicleRow" style="display:none;">
              <td colspan="2">Vehicle:</td>
              <td id="vehicleStatus"></td>
              <td colspan="3">Distance:</td>
              <td>
                <span id="vehicleDist"></span>&nbsp;cm<span style="font-size: 0.8em;">&nbsp;(<span
                    id="vehicleDistInch"></span>&nbsp;inch)</span>
              </td>
            </tr>
          </table>
        </div>
        <div id="GDOcontrols" class="fullwidth button-row"
          style="padding-left: 0%; padding-right: 0%; display: flex; justify-content: space-between;">
          <input type="button" id="lightButton" value="Light On" style="width: 23%;"
            onclick="setGDO('garageLightOn', (event.target.value === 'Light On') ? '1' : '0');">
          <input type="button" id="doorButton" value="Open Door" style="width: 23%;"
            onclick="setGDO('garageDoorState', (event.target.value === 'Close Door') ? '0' : '1');">
          <input type="button" id="lockButton" value="Lock Remotes" style="width: 23%;"
            onclick="setGDO('garageLockState', (event.target.value === 'Disable Remotes') ? '1' : '0');">
          <input type="button" id="laserButton" value="Laser On" style="display:none; width: 23%;"
            onclick="setGDO('assistLaser', (event.target.value === 'Laser On') ? '1' : '0');">
        </div>
      </div>
      <!-- Settings section of page ------------------------------------------------------------------>
      <div id="settings-page" style="display: none; padding-left: 0px; padding-right: 0px;">
        <div class="fullwidth" style="padding-top: 0px; padding-bottom: 0px;">
          <div>
            <table class="password">
              <tr>
                <td class="label">Username:</td>
                <td>
                  <input id="newUserName" type="text" placeholder="admin" maxlength="30" minlength="1">
                </td>
                <td></td>
              </tr>
              <tr>
                <td class="label">Password:</td>
                <td>
                  <input id="newPassword" type="password" placeholder="new password" autocomplete="new-password">
                </td>
                <td></td>
              </tr>
              <tr>
                <td class="label">Confirm:</td>
                <td>
                  <input id="confirmPassword" type="password" placeholder="confirm new password">
                </td>
                <td>&nbsp;&nbsp;&nbsp;
                  <input type="button" value="Save User/Password" onclick="changePassword()">
                </td>
              </tr>
              <tr>
                <td></td>
                <td id="matchMsg" style="font-size: 0.6em;"><br></td>
              </tr>
            </table>
          </div>
        </div>
        <div class="fullwidth" style="padding-top: 0px; padding-bottom: 0px;">
          <div style="padding-left: 0; padding-right: 0; width: 100%">
            <table class="settings">
              <tr>
                <td style="font-size: 0.65em;"><u>No reboot required:</u></td>
                <td></td>
              </tr>
              <tr>
                <td class="label">Name:</td>
                <td>
                  <input id="newDeviceName" type="text" placeholder="" maxlength="30" minlength="1">
                </td>
              </tr>
              <tr>
                <td class="label">Require Password:</td>
                <td>
                  <input type="checkbox" id="pwreq" name="pwreq" value="no">
                  <span style="font-size: 0.8em;">default: admin/password</span>
                </td>
              </tr>
              <tr>
                <td class="label">LED activity:</td>
                <td>
                  <input type="radio" id="LEDidle0" name="LEDidle" value="0">
                  <label for="LEDidle0">Off when idle</label>
                  <input type="radio" id="LEDidle1" name="LEDidle" value="1">
                  <label for="LEDidle1">On when idle</label>
                  <input type="radio" id="LEDidle2" name="LEDidle" value="2">
                  <label for="LEDidle2">Disable</label>
                </td>
              </tr>
              <tr>
                <td class="label">Syslog:</td>
                <td>
                  <input type="checkbox" id="syslogEn" name="syslogEn" value="no" onchange="toggleSyslog()">
                  <span style="font-size: 0.8em;">Send logs to a syslog server</span>
                </td>
              </tr>
              <tr>
                <td></td>
                <td>
                  <table class="settings" id="syslogTable" style="display: none;">
                    <tr>
                      <td class="IPlabel">Server IP/Port:</td>
                      <td>
                        <input class="syslogIPinput IPinput" id="syslogIP" type="text" placeholder="0.0.0.0"
                          minlength="7" maxlength="15" size="12">&nbsp;:
                        <input class="syslogIPinput IPinput" id="syslogPort" type="text" placeholder="514" minlength="1"
                          maxlength="5" size="5">
                      </td>
                    </tr>
                    <tr>
                      <td class="SyslogPri">Facility:</td>
                      <td>
                        <select class="FCinput" id="syslogFacility">
                          <option value="16" selected>Local 0</option>
                          <option value="17">Local 1</option>
                          <option value="18">Local 2</option>
                          <option value="19">Local 3</option>
                          <option value="20">Local 4</option>
                          <option value="21">Local 5</option>
                          <option value="22">Local 6</option>
                          <option value="23">Local 7</option>
                        </select>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td class="label">Log level:</td>
                <td style="font-size: 0.65em;">
                  <input type="radio" id="logLevel0" name="logLevel" value="0">
                  <label for="logLevel0">None</label>
                  <input type="radio" id="logLevel1" name="logLevel" value="1">
                  <label for="logLevel1">Error</label>
                  <input type="radio" id="logLevel2" name="logLevel" value="2">
                  <label for="logLevel2">Warn</label>
                  <input type="radio" id="logLevel3" name="logLevel" value="3" checked>
                  <label for="logLevel3">Info</label>
                  <input type="radio" id="logLevel4" name="logLevel" value="4">
                  <label for="logLevel4">Debug</label>
                  <input type="radio" id="logLevel5" name="logLevel" value="5">
                  <label for="logLevel5">Verbose</label>
                </td>
              </tr>
              <tr id="homespanSetting" style="display:none;">
                <td class="label">HomeSpan:</td>
                <td>
                  <input type="checkbox" id="homespanCLI" name="homespanCLI" value="no">
                  <label for="homespanCLI">Enable HomeSpan CLI on serial port</label>
                </td>
              </tr>
              <tr>
                <td colspan="2">&nbsp;</td>
              </tr>
              <tr>
                <td class="label">Door Close Delay:</td>
                <td>
                  <input type="range" min="0" max="21" value="5" id="TTCseconds" name="TTCseconds" class="slider"
                    style="width:150px;">
                  <span style="vertical-align: middle; font-size: 0.8em"><span id="TTCsecondsValue"></span>&nbsp;<span
                      id="TTCunits">Seconds</span>&nbsp;<a id="TTCwarning" style="display: none; color: red;"
                      href="https://www.law.cornell.edu/cfr/text/16/1211.14" target="_blank">WARNING</a></span>
                </td>
              </tr>
              <tr>
                <td></td>
                <td>
                  <input type="checkbox" id="TTClight" name="TTClight" checked>
                  <label for="TTClight">Flash light during time-to-close</label>&nbsp;<a id="TTCwarning2"
                    style="display: none; color: red; font-size: 0.8em"
                    href="https://www.law.cornell.edu/cfr/text/16/1211.14" target="_blank">WARNING</a></span>
                </td>
              </tr>
              <tr id="builtInTTCrow">
                <td class="label">Automatic Close:</td>
                <td>
                  <input type="range" min="0" max="20" value="0" id="builtInTTC" name="builtInTTC" class="slider"
                    style="width:150px;">
                  <span style="vertical-align: middle; font-size: 0.8em"><span id="builtInTTCValue"></span>&nbsp;<span
                      id="builtInUnits">Minutes</span>&nbsp;<a id="builtInWarning" style="display: none; color: red;"
                      href="https://github.com/ratgdo/homekit-ratgdo/blob/main/README.md#automatic-close"
                      target="_blank">WARNING</a></span>
                </td>
              </tr>
              <tr>
                <td colspan="2">&nbsp;</td>
              </tr>
              <tr id="homekitLightRow" style="display:none;">
                <td class="label">Light:</td>
                <td>
                  <input type="checkbox" id="lightHomeKit" name="lightHomeKit" value="no" checked>
                  <label for="lightHomeKit">HomeKit Light Switch</label>
                </td>
              <tr>
                <td class="label">Motion Triggers:</td>
                <td>
                  <input type="checkbox" id="motionMotion" name="motionMotion" value="no" disabled>
                  <label for="motionMotion">Motion</label>
                  <input type="checkbox" id="motionObstruction" name="motionObstruction" value="no">
                  <label for="motionObstruction">Obstruction</label>
                  <span id="motionWallPanelSpan">
                    <input type="checkbox" id="motionWallPanel" name="motionWallPanel" value="no">
                    <label for="motionWallPanel">Wall Panel</label>
                  </span>
                </td>
              </tr>
              <tr id="trOccupancyDuration" style="display: none">
                <td></td>
                <td>
                  <table class="settings">
                    <tr>
                      <td class="label">Occupancy&nbsp;Duration:</td>
                      <td>
                        <input type="range" min="0" max="32" value="0" id="occupancyDuration" name="occupancyDuration"
                          class="slider" style="width:100px;">
                        <span style="vertical-align: middle;"><span id="occupancyValue"></span>&nbsp;<span
                            id="occupancyUnits">Mins</span></span>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr id="homekitMotionRow" style="display: none">
                <td></td>
                <td>
                  <span id="motionHomeKitSpan">
                    <input type="checkbox" id="motionHomeKit" name="motionHomeKit" value="no" checked>
                    <label for="motionHomeKit">HomeKit Motion Sensor</label>
                  </span>
                </td>
              </tr>
              <tr id="vehicleSettingsSpacer" style="display:none;">
                <td colspan="2">&nbsp;</td>
              </tr>
              <tr id="vehicleSetting" style="display:none;">
                <td class="label">Vehicle Distance:</td>
                <td>
                  <input type="range" min="5" max="300" value="180" step="5" id="vehicleThreshold"
                    name="vehicleThreshold" class="slider" style="width:130px;">
                  <span style="vertical-align: middle; font-size: 0.8em">
                    <span id="vehicleThresholdCM"></span>&nbsp;cm<span style="font-size: 0.8em;">&nbsp;(<span
                        id="vehicleThresholdInch"></span>&nbsp;inch)</span>
                </td>
              </tr>
              <tr id="vehicleHomeKitRow" style="display:none;">
                <td></td>
                <td>
                  <input type="checkbox" id="vehicleHomeKit" name="vehicleHomeKit" value="no"
                    onchange="handleVehicleHomeKitToggle(this.checked)">
                  <label for="vehicleHomeKit">HomeKit Vehicle Occupancy & Motion</label>
                </td>
              </tr>
              <tr id="vehicleSensorOptions" style="display:none;">
                <td></td>
                <td style="font-size: 0.65em;">
                  <input type="checkbox" id="vehicleOccupancyHomeKit" name="vehicleOccupancyHomeKit" value="no">
                  <label for="vehicleOccupancyHomeKit">Vehicle&nbsp;Occupancy</label>
                  <input type="checkbox" id="vehicleArrivingHomeKit" name="vehicleArrivingHomeKit" value="no">
                  <label for="vehicleArrivingHomeKit">Arriving&nbsp;Motion</label>
                  <input type="checkbox" id="vehicleDepartingHomeKit" name="vehicleDepartingHomeKit" value="no">
                  <label for="vehicleDepartingHomeKit">Departing&nbsp;Motion</label>
                </td>
              </tr>
              <tr id="laserSetting" style="display:none;">
                <td class="label">Laser:</td>
                <td>
                  <input type="checkbox" id="laserEnabled" name="laserEnabled" value="no"
                    onchange="enableLaser(this.checked)">
                  <label for="laserEnabled">Enabled</label>
                  <input type="checkbox" id="laserHomeKit" name="laserHomeKit" value="no" disabled>
                  <label for="laserHomeKit">HomeKit Light Switch</label>
                </td>
              </tr>
              <tr>
                <td></td>
                <td>
                  <table class="settings" id="parkAssist" style="display: none;">
                    <tr>
                      <td class="label">Assist&nbsp;Duration:</td>
                      <td>
                        <input type="range" min="0" max="300" value="60" step="5" id="assistDuration"
                          name="assistDuration" class="slider" style="width:100px;">
                        <span style="vertical-align: middle;"><span id="assistValue"></span>&nbsp;<span
                            id="assistUnits">Secs</span></span>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td style="font-size: 0.65em;"><br><u>Reboot required:</u></td>
                <td></td>
              </tr>
              <tr>
                <td class="label">Door&nbsp;Protocol:</td>
                <td>
                  <input type="radio" id="gdosec1" name="gdosecuritysetting" value="1"
                    onclick="toggleDCOpenClose(this)">
                  <label for="gdosec1">Sec+</label>
                  <input type="radio" id="gdosec2" name="gdosecuritysetting" value="2"
                    onclick="toggleDCOpenClose(this)">
                  <label for="gdosec2">Sec+ 2.0</label>
                  <input type="radio" id="gdodrycontact" name="gdosecuritysetting" value="3"
                    onclick="toggleDCOpenClose(this)">
                  <label for="gdodrycontact">Dry Contact</label>
                </td>
              </tr>
              <tr id="dcDebounceDurationRow" style="display:none;">
                <td></td>
                <td>
                  <table class="settings">
                    <tr>
                      <td class="label">Debounce&nbsp;Duration:</td>
                      <td>
                        <input type="range" min="50" max="1000" value="50" step="50" id="dcDebounceDuration"
                          name="dcDebounceDuration" class="slider" style="width:100px;">
                        <span style="vertical-align: middle;"><span id="dcDebounceValue"></span>&nbsp;ms</span>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr id="useToggleRow" style="display:none;">
                <td></td>
                <td>
                  <input type="checkbox" id="useToggle" name="useToggle" value="no">
                  <label for="useToggle">Use Sec+2.0 toggle instead of close command</label>
                </td>
              </tr>
              <tr id="dcOpenCloseRow" style="display:none;">
                <td></td>
                <td>
                  <input type="checkbox" id="dcOpenClose" name="dcOpenClose" value="no">
                  <label for="dcOpenClose">Enable hardwired open/close/light control</label>
                </td>
              </tr>
              <tr id="useSWserialRow" style="display:none;">
                <td></td>
                <td>
                  <input type="checkbox" id="useSWserial" name="useSWserial" value="no">
                  <label for="useSWserial">Use software serial emulation rather than h/w UART</label>
                </td>
              </tr>
              <tr id="obstFromStatusRow" style="display:none;">
                <td></td>
                <td>
                  <input type="checkbox" id="obstFromStatus" name="obstFromStatus" value="no">
                  <label for="obstFromStatus">Get obstruction from GDO status messages</label>
                </td>
              </tr>
              <tr id="trWifiPhyMode" style="display: none">
                <td class="label">WiFi Version:</td>
                <td>
                  <input type="radio" id="wifiPhyMode0" name="wifiPhyMode" value="0">
                  <label for="wifiPhyMode0">Auto</label>
                  <input type="radio" id="wifiPhyMode1" name="wifiPhyMode" value="1">
                  <label for="wifiPhyMode1">802.11b</label>
                  <input type="radio" id="wifiPhyMode2" name="wifiPhyMode" value="2">
                  <label for="wifiPhyMode2">802.11g</label>
                  <input type="radio" id="wifiPhyMode3" name="wifiPhyMode" value="3">
                  <label for="wifiPhyMode3">802.11n</label>
                </td>
              </tr>
              <tr id="trWifiPower" style="display: none">
                <td class="label">WiFi Tx Power:</td>
                <td>
                  <input type="range" min="0" max="20" value="20" id="wifiPower" name="wifiPower" class="slider"
                    style="width:100px;">
                  <span style="vertical-align: middle; font-size: 0.8em"><span id="wifiPowerValue"></span> dBm</span>
                </td>
              </tr>
              <tr id="trEnableIPv6" style="display: none">
                <td class="label">Enable IPv6:</td>
                <td>
                  <input type="checkbox" id="enableIPv6" name="enableIPv6" value="no">
                  <label for="enableIPv6">Acquire IPv6 address from network.</label>
                </td>
              </tr>
              <tr>
                <td class="label">Static IPv4:</td>
                <td>
                  <input type="checkbox" id="staticIP" name="staticIP" value="no" onchange="toggleStaticIP()">
                </td>
              </tr>
              <tr>
                <td></td>
                <td>
                  <table class="settings" id="staticIPtable" style="display: none;">
                    <tr>
                      <td class="IPlabel">IP Address:</td>
                      <td>
                        <input class="staticIPinput IPinput" id="IPaddress" type="text" placeholder="0.0.0.0"
                          minlength="7" maxlength="15" size="12">
                      </td>
                    </tr>
                    <tr>
                      <td class="IPlabel">Netmask:</td>
                      <td>
                        <input class="staticIPinput IPinput" id="IPnetmask" type="text" placeholder="0.0.0.0"
                          minlength="7" maxlength="15" size="12">
                      </td>
                    </tr>
                    <tr>
                      <td class="IPlabel">Gateway:</td>
                      <td>
                        <input class="staticIPinput IPinput" id="IPgateway" type="text" placeholder="0.0.0.0"
                          minlength="7" maxlength="15" size="12">
                      </td>
                    </tr>
                    <tr>
                      <td class="IPlabel">DNS Server:</td>
                      <td>
                        <input class="staticIPinput IPinput" id="IPnameserver" type="text" placeholder="0.0.0.0"
                          minlength="7" maxlength="15" size="12">
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td class="label">Enable NTP:</td>
                <td>
                  <input type="checkbox" id="enableNTP" name="enableNTP" value="no" onchange="toggleTimeZone()">
                  <span style="font-size: 0.8em;">Obtain time from NTP server</span>
                </td>
              </tr>
              <tr>
                <td></td>
                <td>
                  <table class="settings" id="timeZoneTable" style="display: none;">
                    <tr>
                      <td class="IPlabel">Time Zone:</td>
                      <td>
                        <select class="TZinput" id="timeZoneInput">
                        </select>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td>
                  <!--
                    Future settings go here
                  -->
                </td>
              </tr>
              <tr>
                <td class="label">Reboot Every:</td>
                <td>
                  <input type="number" id="rebootHours" name="rebootHours" value="0" , min="0" , max="72" , step="1">
                  Hours <span style="font-size: 0.8em;">(never:0, min:1, max:72)</span>
                </td>
              </tr>
              <tr>
                <td></td>
              </tr>
              <tr>
                <td></td>
                <td>
                  <input type="button" value="Save Settings" onclick="saveSettings()">
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="fullwidth button-row"
          style="padding-left: 0%; padding-right: 0%; display: flex; justify-content: space-between;">
          <input type="button" value="Reset Door" style="width: 23%;" onclick="resetDoor()">
          <input type="button" value="Set WiFi SSID" style="width: 23%;" onclick="setSSID()">
          <input type="button" value="Boot Soft AP" style="width: 23%;" onclick="bootSoftAP()">
          <input type="button" value="Factory Reset" style="width: 23%;" onclick="factoryReset()">
        </div>
      </div>
    </main>
    <!-- Footer section of page ------------------------------------------------------------------>
    <footer>
      <div class="footer">
        <p id="autoCloseWarning"
          style="display:none; margin:0px; padding-bottom: 7px; border-bottom-style: solid; border-bottom-width: 1px; margin-bottom: 4px;">
          <a style="color: red;" href="https://github.com/ratgdo/homekit-ratgdo/blob/main/README.md#automatic-close"
            target="_blank">WARNING</a>&nbsp;Automatic&nbsp;door&nbsp;close&nbsp;<span id="autoCloseValue"></span>
        </p>
        <p style="margin:0px; padding-bottom: 4px;">For documentation and support see the <a id="docsLink"
            href="https://github.com/ratgdo/homekit-ratgdo">GitHub</a>
          page.<br>Copyright (c) 2023-25 <a id="contribLink"
            href="https://github.com/ratgdo/homekit-ratgdo/graphs/contributors">homekit-ratgdo
            contributors.</a><br>Licensed under terms of the <a
            href="https://www.gnu.org/licenses/gpl-3.0.en.html">GPL-3.0
            License.</a>
        </p>
        <table style="font-size: 0.8em;">
          <colgroup>
            <col width="17%">
            <col width="17%">
            <col width="17%">
            <col width="17%">
            <col width="17%">
            <col width="15%">
          </colgroup>
          <tr id="freeMemRow">
            <td colspan="2" style="padding: 0px; padding-right: 10px">
              freeHeap:&nbsp;<span id="freeHeap">0</span>&nbsp;
            </td>
            <td colspan="2" style="padding: 0px; padding-right: 10px;">
              minHeap:&nbsp;<span id="minHeap">0</span>&nbsp;
            </td>
            <td id="tdStack" colspan="2" style="padding: 0px; display: none;">
              minStack:&nbsp;<span id="minStack">0</span>&nbsp;
            </td>
          </tr>
          <tr>
            <td colspan="2" style="padding: 0px;">lastDoorChange:&nbsp;</td>
            <td colspan="4" style="padding: 0px;" id="doorUpdateAt"></td>
          </tr>
          <tr>
            <td colspan="2" style="padding: 0px;">lastReboot:&nbsp;</td>
            <td colspan="4" style="padding: 0px;" id="lastRebootAt"></td>
          </tr>
        </table>
        <p style="margin:0px; padding-top:4px">
          <a href="logs.html?v=CRC-32" target="_blank">Show system logs</a>&nbsp;(crashCount:&nbsp;<span
            id="crashCount"></span>)
        </p>
      </div>
    </footer>
  </div>

  <!-- Popup / modal dialog ------------------------------------------------------------------>
  <div id="myModal" class="modal">
    <div class="modal-content">
      <span id="modalClose" class="close"
        onclick="document.getElementById('myModal').style.display = 'none'">&times;</span>
      <span id="modalTitle">Installed Firmware:&nbsp;<span id="firmwareVersion2">xxx</span><br></span><br>
      <div id="updateDialog" style="float: none; padding:0px">
        <fieldset>
          <legend>Update from local file</legend>
          <input type="file" accept=".bin,.bin.gz" name="firmware" style="border: 0px; padding: 0px;">
          <input type="button" value="Update" style="float: right;" onclick="firmwareUpdate(false)">
        </fieldset>
        <br>
        <fieldset>
          <legend>Update from GitHub</legend>
          <table>
            <tr>
              <td style="text-align: right;">Latest available at GitHub:</td>
              <td><span id="newversion2"></span><span id="dotdot2"></span></td>
            </tr>
          </table>
          <input type="button" value="Check for update" onclick="checkVersion('dotdot2')">
          <input type="checkbox" id="prerelease" name="prerelease" value="no">
          <span style="font-size: 0.8em;">Include pre-releases</span>
          <input type="button" value="Update" style="float: right;" onclick="firmwareUpdate(true)">
          <span id="firmwareDescription" style="font-size: 0.6em;"></span>
        </fieldset>
      </div>
      <div id="updateDotDot" style="display:none; float: none; padding:0px">
        <span id="updateMsg">Do not close browser until update completes. Device will reboot when complete.<br></span>
        <span id="updatePercent" style="display:none;"></span><span id="dotdot3"></span>
        <br><br>
      </div>
    </div>
  </div>

  <!-- Initialization scripts ------------------------------------------------------------------>
  <script>
    // Set global constants
    const loaderElem = document.getElementById("loader"); // Spinner while pages load
    const iOSiPadOS = navigator.platform.startsWith("iP") || navigator.platform.startsWith("Mac") && navigator.maxTouchPoints > 4;

    // Remove the border line when displayed on iOS devices and lock the title to top of screen
    if (iOSiPadOS) {
      document.getElementById("fullpage").style.borderStyle = "none";
      document.getElementById("fullpage").style.padding = "5px";
      document.getElementById("header").style.position = "fixed";
      document.getElementById("header").style.zIndex = "1000";
      document.getElementById("header").style.top = "0px";
      document.getElementById("header").style.width = "calc(100% - 24px)";
      document.getElementById("main-page").style.paddingTop = "3.5em";
      document.getElementById("settings-page").style.paddingTop = "3.5em";
    }

    // Retrieve status from the server, runs asynchronously
    checkStatus();
    // Load time zone info, this runs asynchronously
    loadTimeZones();

    // reload status if visibility change
    window.addEventListener("visibilitychange", (event) => {
      if (document.visibilityState === "visible") {
        checkStatus();
      }
    });

    // Handle mobile device swipe-down to reload...
    document.addEventListener('touchstart', function (e) { swipeStart(e); }, false);
    document.addEventListener('touchend', function (e) { swipeEnd(e); }, false);

    // Control show/hide of the main page and settings page
    function showSettings() {
      document.getElementById("settings-icon").style.display = "none";
      document.getElementById("main-page").style.display = "none";
      document.getElementById("settings-page").style.display = "block";
      document.getElementById("main-icon").style.display = "block";
      loadTZinfo(document.getElementById("timeZoneInput"));
    }
    function showMainpage() {
      document.getElementById("main-icon").style.display = "none";
      document.getElementById("settings-page").style.display = "none";
      document.getElementById("main-page").style.display = "block";
      document.getElementById("settings-icon").style.display = "block";
    };
    document.getElementById("settings-icon").onclick = async () => {
      // Only display the Settings page if user is authenticated.
      if (await checkAuth()) {
        showSettings();
        history.pushState("settings", "");
      }
    };

    // Control how we handle the back button on browser
    history.replaceState("mainpage", "");
    window.addEventListener("popstate", (e) => {
      if (e.state === "mainpage") {
        showMainpage();
      }
      else if (e.state === "settings") {
        showSettings();
      }
    });

    // Check new passwords match when typed in.
    newPW = document.getElementById("newPassword");
    confirmPW = document.getElementById("confirmPassword");
    matchMsg = document.getElementById("matchMsg");
    newPW.oninput = (event) => {
      if (newPW.value === confirmPW.value) {
        matchMsg.innerHTML = "<br>";
      }
      else {
        matchMsg.innerHTML = "Passwords do not match<br>";
      }
    };
    confirmPW.oninput = (event) => {
      if (newPW.value === confirmPW.value) {
        matchMsg.innerHTML = "<br>";
      }
      else {
        matchMsg.innerHTML = "Passwords do not match<br>";
      }
    };

    // Allow only numeric keystrokes into the reboot every X hours field
    document.getElementById("rebootHours").addEventListener("keypress", (event) => {
      if (event.which < 48 || event.which > 57) {
        event.preventDefault();
      }
    });

    // Allow only numeric and dot keystrokes into IP Address fields
    Array.from(document.getElementsByClassName("IPinput")).forEach(function (inputField) {
      inputField.addEventListener("keypress", (event) => {
        if ((event.which < 48 || event.which > 57) && (event.which != 46)) {
          event.preventDefault();
        }
      });
    });

    // This handles user control of sliders
    WiFiSlider = document.getElementById("wifiPower");
    WiFiText = document.getElementById("wifiPowerValue");
    WiFiText.innerText = WiFiSlider.value;
    WiFiSlider.oninput = function () {
      WiFiText.innerText = this.value;
    };

    // Time-to-close delay slider
    TTCslider = document.getElementById("TTCseconds");
    TTCtext = document.getElementById("TTCsecondsValue");
    TTCtext.innerText = ((TTCslider.value <= 10) ? TTCslider.value : (TTCslider.value <= 20) ? ((TTCslider.value - 10) * 5) + 10 : 300);
    TTCslider.oninput = function () {
      if (this.value > 0) {
        TTCtext.innerText = ((this.value <= 10) ? this.value :
          (this.value <= 20) ? ((this.value - 10) * 5) + 10 : 300);
      }
      else {
        TTCtext.innerText = "Off";
        document.getElementById("TTCunits").style.display = "none";
      }
      document.getElementById("TTCwarning").style.display = (this.value < 5) ? "inline" : "none";
    };
    document.getElementById("TTClight").onclick = function () {
      document.getElementById("TTCwarning2").style.display = (this.checked) ? "none" : "inline";
    };

    // Automatic close slider
    document.getElementById("builtInTTC").oninput = function () {
      let seconds = (this.value <= 10) ? this.value * 60 :
        (this.value <= 20) ? ((this.value - 10) * 300) + 600 : 3600;
      if (this.value > 0) {
        document.getElementById("builtInTTCValue").innerText = Math.floor(seconds / 60);
        document.getElementById("builtInUnits").style.display = "inline";
        document.getElementById("builtInWarning").style.display = "inline";
      }
      else {
        document.getElementById("builtInTTCValue").innerText = "Off";
        document.getElementById("builtInUnits").style.display = "none";
        document.getElementById("builtInWarning").style.display = "none";
      }
    };

    // Vehicle distance threshold slider
    vDistSlider = document.getElementById("vehicleThreshold");
    vDistText1 = document.getElementById("vehicleThresholdCM");
    vDistText2 = document.getElementById("vehicleThresholdInch");
    vDistText1.innerText = vDistSlider.value;
    vDistText2.innerText = (Math.round(vDistSlider.value / .254) / 10);
    vDistSlider.oninput = function () {
      vDistText1.innerText = this.value;
      vDistText2.innerText = (Math.round(this.value / .254) / 10);
    };

    // Parking assist laser slider
    PAslider = document.getElementById("assistDuration");
    PAtext = document.getElementById("assistValue");
    PAtext.innerText = PAslider.value;
    PAslider.oninput = function () {
      if (this.value > 0) {
        PAtext.innerText = this.value;
        document.getElementById("assistUnits").style.display = "inline";
      } else {
        PAtext.innerText = "Off";
        document.getElementById("assistUnits").style.display = "none";
      }
    };

    // Dry-contact debounce slider
    DBslider = document.getElementById("dcDebounceDuration");
    DBtext = document.getElementById("dcDebounceValue");
    DBtext.innerText = DBslider.value;
    DBslider.oninput = function () {
      DBtext.innerText = this.value;
    };

    // Occupancy duration slider
    occSlider = document.getElementById("occupancyDuration");
    occText = document.getElementById("occupancyValue");
    occText.innerText = ((occSlider.value <= 10) ? occSlider.value : (occSlider.value <= 32) ? ((occSlider.value - 10) * 5) + 10 : 0);
    occSlider.oninput = function () {
      if (this.value > 0) {
        occText.innerText = ((this.value <= 10) ? this.value : (this.value <= 32) ? ((this.value - 10) * 5) + 10 : 0);
        document.getElementById("occupancyUnits").style.display = "inline";
      } else {
        occText.innerText = "Off";
        document.getElementById("occupancyUnits").style.display = "none";
      }
    };

  </script>
</body>

</html>